<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serene Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/meditation-timer.css">
</head>
<body>
    <div id="background-gallery"></div>
    <div class="background-svg-container" id="background-svg-animations">
        <!-- SVGs will be injected here by JavaScript or defined statically -->
        <svg class="svg-mount-fuji" viewBox="0 0 200 100" preserveAspectRatio="xMidYMax meet">
            <path d="M0 100 L60 100 L100 20 L140 100 L200 100 L200 100 L0 100 Z" fill="rgba(100, 100, 120, 0.3)"/>
            <path d="M70 100 L100 40 L130 100 Z" fill="rgba(200, 200, 210, 0.5)"/>
        </svg>
        <svg class="svg-sakura-branch" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
            <path d="M50 100 C 40 80, 30 70, 10 60" stroke="rgba(80,50,50,0.3)" stroke-width="3" fill="none"/>
            <circle cx="10" cy="60" r="5" fill="rgba(255,182,193,0.4)"/>
            <circle cx="20" cy="65" r="4" fill="rgba(255,182,193,0.4)"/>
            <circle cx="30" cy="75" r="6" fill="rgba(255,182,193,0.4)"/>
        </svg>
    </div>
    <div class="dashboard-container">
        <header class="dashboard-header glassmorphism-header">
            <h1>Serene Dashboard</h1>
        </header>
        <main class="dashboard-main">
            <aside class="column column-sidebar">
                <h2>Customization</h2>
                <div id="theme-customization-panel" class="widget">
                    <h3>Theme Customization</h3>
                    <div id="palette-selection" aria-labelledby="palette-selection-title">
                        <h4 id="palette-selection-title">Select a Color Palette:</h4>
                        <div class="palette-buttons">
                            <button class="btn theme-selector-btn" data-theme="default" aria-pressed="true">Default</button>
                            <button class="btn theme-selector-btn" data-theme="sakura" aria-pressed="false">Sakura</button>
                            <button class="btn theme-selector-btn" data-theme="momiji" aria-pressed="false">Momiji</button>
                            <button class="btn theme-selector-btn" data-theme="yuki" aria-pressed="false">Yuki</button>
                            <button class="btn theme-selector-btn" data-theme="haru" aria-pressed="false">Haru</button>
                            <button class="btn theme-selector-btn" data-theme="dento" aria-pressed="false">Dent≈ç</button>
                            <button class="btn theme-selector-btn" data-theme="seki" aria-pressed="false">Seki</button>
                            <button class="btn theme-selector-btn" data-theme="natsu" aria-pressed="false">Natsu</button>
                        </div>
                    </div>
                    <div class="setting-row">
                        <input type="checkbox" id="seasonal-automation-toggle">
                        <label for="seasonal-automation-toggle">Enable Automatic Seasonal Theme</label>
                    </div>
                    <div class="setting-row">
                        <input type="radio" id="hemisphere-northern" name="hemisphere" value="northern" checked>
                        <label for="hemisphere-northern">Northern Hemisphere</label>
                        <input type="radio" id="hemisphere-southern" name="hemisphere" value="southern">
                        <label for="hemisphere-southern">Southern Hemisphere</label>
                    </div>
                    <div id="seasonal-preview-controls" class="setting-group">
                        <h4>Preview Seasons:</h4>
                        <div class="button-group">
                            <button id="preview-prev-season-btn" class="btn btn-secondary"><i class="fas fa-chevron-left"></i> Prev</button>
                            <button id="preview-next-season-btn" class="btn btn-secondary">Next <i class="fas fa-chevron-right"></i></button>
                        </div>
                        <button id="exit-seasonal-preview-btn" class="btn btn-secondary hidden">Exit Preview</button>
                        <p id="seasonal-preview-info"></p>
                    </div>
                    <div id="widget-appearance-controls" class="setting-group">
                        <h4>Widget Appearance:</h4>
                        <div class="slider-control">
                            <label for="global-widget-opacity-slider">Opacity:</label>
                            <input type="range" id="global-widget-opacity-slider" min="0.2" max="1" step="0.05" value="1">
                            <span id="global-widget-opacity-value">100%</span>
                        </div>
                        <div class="slider-control">
                            <label for="widget-background-blur-slider">Blur:</label>
                            <input type="range" id="widget-background-blur-slider" min="0" max="20" step="1" value="0">
                            <span id="widget-background-blur-value">0px</span>
                        </div>
                        <div class="preset-buttons">
                            <label>Presets:</label>
                            <button class="btn btn-sm btn-secondary preset-transparency-btn" data-opacity="0.9" data-blur="2">Subtle</button>
                            <button class="btn btn-sm btn-secondary preset-transparency-btn" data-opacity="0.75" data-blur="5">Balanced</button>
                            <button class="btn btn-sm btn-secondary preset-transparency-btn" data-opacity="0.6" data-blur="10">Prominent</button>
                        </div>
                    </div>
                    <div id="layout-selection-controls" class="setting-group">
                        <h4>Layout Templates:</h4>
                        <div class="layout-buttons">
                            <button class="btn layout-selector-btn" data-layout="default" aria-pressed="true">Default</button>
                            <button class="btn layout-selector-btn" data-layout="traditional-grid" aria-pressed="false">Grid</button>
                            <button class="btn layout-selector-btn" data-layout="minimalist-center" aria-pressed="false">Minimal</button>
                            <button class="btn layout-selector-btn" data-layout="asymmetrical-zen" aria-pressed="false">Zen</button>
                            <button class="btn layout-selector-btn" data-layout="seasonal-flow" aria-pressed="false">Flow</button>
                        </div>
                    </div>
                    <!-- Collapsible advanced settings for individual opacity could go here -->
                </div>
            </aside>
            <div class="column column-content">
                <div class="welcome-message">
                    <h2>Welcome to your serene space.</h2>
                </div>
            </div>
            <aside class="column column-widgets">
                <h2>Widgets</h2>
                <!-- Daily Inspiration Widget START -->
                <div id="daily-inspiration-widget" class="widget" role="complementary" aria-labelledby="daily-inspiration-title">
                    <div class="widget-header">
                        <h3 id="daily-inspiration-title">Daily Inspiration</h3>
                        <div class="widget-actions">
                             <button id="inspiration-copy-btn" class="icon-btn" aria-label="Copy inspiration" title="Copy"><i class="fas fa-copy"></i></button>
                        </div>
                    </div>
                    <div id="inspiration-content-area">
                        <div id="inspiration-type-indicator" aria-hidden="true"></div>
                        <p id="inspiration-japanese-text" lang="ja"></p>
                        <p id="inspiration-romaji-text" class="romaji-text"></p>
                        <p id="inspiration-english-text" lang="en"></p>
                        <p id="inspiration-explanation" class="explanation-text"></p>
                        <p id="inspiration-source" class="source-text"></p>
                    </div>
                    <div id="inspiration-controls" class="widget-controls">
                        <div class="control-row">
                            <select id="language-toggle" aria-label="Language display mode">
                                <option value="dual">Dual (JP + EN)</option>
                                <option value="jp_primary">Japanese Primary</option>
                                <option value="en_primary">English Primary</option>
                            </select>
                            <label for="romaji-toggle" class="romaji-toggle-label">
                                <input type="checkbox" id="romaji-toggle" checked> Romaji
                            </label>
                        </div>
                        <div class="control-row buttons-right">
                            <button id="inspiration-prev-btn" class="icon-btn" aria-label="Previous inspiration" title="Previous"><i class="fas fa-chevron-left"></i></button>
                            <button id="inspiration-random-btn" class="icon-btn" aria-label="Random inspiration" title="Random"><i class="fas fa-random"></i></button>
                        </div>
                    </div>
                </div>
                <!-- Daily Inspiration Widget END -->
    <div id="time-date-widget" role="timer" aria-live="polite" aria-atomic="true" class="widget">
        <div id="time-display" aria-label="Current time">
            <span id="hours"></span><span class="time-separator">:</span><span id="minutes"></span><span class="time-separator">:</span><span id="seconds"></span> <span id="am-pm"></span>
        </div>
        <div id="date-display" aria-label="Current date"></div>
        <button id="widget-settings-button" class="icon-btn settings-btn" aria-label="Time widget settings" aria-haspopup="true" aria-expanded="false"><i class="fas fa-cog"></i></button>
        <div id="widget-settings-panel" class="hidden glass-panel" role="region" aria-labelledby="settings-panel-title">
            <h4 id="settings-panel-title">Settings</h4>
            <label for="time-format-toggle" class="checkbox-label">
                <input type="checkbox" id="time-format-toggle"> 24-Hour Format
            </label>
        </div>
    </div>
    <div id="weather-widget" class="widget">
        <div class="weather-main">
            <div class="weather-info-left">
                <div id="weather-location">--</div>
                <div id="weather-condition">--</div>
            </div>
            <div class="weather-info-right">
                <div id="weather-temp-current">--¬∞</div>
                <div id="weather-icon-current"><svg width="48" height="48"></svg></div>
            </div>
        </div>
        <div class="weather-details">
            <div id="weather-temp-feels-like">Feels like: --¬∞</div>
            <div id="weather-humidity">Humidity: --%</div>
            <div id="weather-wind">Wind: -- m/s</div>
        </div>

        <div id="weather-forecast-daily">
            <div class="forecast-day"><span>Mon</span><svg width="24" height="24"></svg><span>--¬∞</span></div>
            <div class="forecast-day"><span>Tue</span><svg width="24" height="24"></svg><span>--¬∞</span></div>
            <div class="forecast-day"><span>Wed</span><svg width="24" height="24"></svg><span>--¬∞</span></div>
            <div class="forecast-day"><span>Thu</span><svg width="24" height="24"></svg><span>--¬∞</span></div>
            <div class="forecast-day"><span>Fri</span><svg width="24" height="24"></svg><span>--¬∞</span></div>
        </div>
        <div class="weather-search">
            <input type="text" id="weather-location-search" placeholder="Search city...">
            <button id="weather-refresh-button" class="icon-btn"><i class="fas fa-search"></i></button>
        </div>
        <div id="weather-last-updated">Updated: --:--</div>
    </div>

    <div id="quick-links-panel" class="widget">
        <div class="widget-header">
            <h3>Quick Links</h3>
            <button id="add-link-btn" class="btn btn-sm btn-primary"><i class="fas fa-plus"></i> Add</button>
        </div>

        <div id="quick-links-list">
            <!-- Links will be added here by JavaScript -->
        </div>
        <div id="quick-links-empty-state">
            <div class="empty-state-icon">‚õ©Ô∏è</div>
            <p>Add your favorite sites.</p>
            <button id="add-link-empty-state-btn" class="btn btn-primary">Add First Link</button>
        </div>
        <div class="quick-links-actions footer-actions">
            <button id="export-links-btn" class="btn btn-sm btn-outline"><i class="fas fa-file-export"></i> Export</button>
            <input type="file" id="import-links-file" accept=".json" style="display: none;">
            <button id="import-links-btn" class="btn btn-sm btn-outline"><i class="fas fa-file-import"></i> Import</button>
        </div>
    </div>

    <!-- New Meditation Timer Widget -->
    <div id="meditation-timer-widget" class="widget">
        <h3>Meditation Timer</h3>
        <div class="timer-display-container">
            <svg class="progress-ring" width="180" height="180">
                <circle class="progress-ring-bg" cx="90" cy="90" r="80" stroke-width="8" fill="transparent"/>
                <circle class="progress-ring-circle" cx="90" cy="90" r="80" stroke-width="8" fill="transparent"
                        stroke-dasharray="502.65" stroke-dashoffset="502.65"/>
            </svg>
            <span id="time-text">00:00</span>
        </div>
        <div class="timer-controls">
            <button id="meditation-play-btn" class="control-btn big-btn" aria-label="Play"><i class="fas fa-play"></i></button>
            <button id="meditation-pause-btn" class="control-btn big-btn hidden" aria-label="Pause"><i class="fas fa-pause"></i></button>
            <button id="meditation-stop-btn" class="control-btn big-btn" aria-label="Stop"><i class="fas fa-stop"></i></button>
        </div>
        <div class="meditation-presets">
            <button class="preset-btn" data-duration="300">5m</button>
            <button class="preset-btn" data-duration="600">10m</button>
            <button class="preset-btn" data-duration="900">15m</button>
            <div class="custom-duration">
                <input type="number" id="custom-duration-input" min="1" max="60" placeholder="Min">
                <button id="custom-duration-btn" class="btn-sm">Set</button>
            </div>
        </div>

        <!-- Hidden sections for brevity, functionality remains same but polished CSS will handle them -->
        <div id="pomodoro-phase-display" class="widget-subsection-title hidden"></div>
        <div class="pomodoro-controls widget-section collapsed-section">
            <button id="toggle-pomodoro-btn" class="btn-text">Pomodoro Mode</button>
            <!-- ... content ... -->
        </div>
        <div class="widget-section sound-settings collapsed-section">
            <h4>Sound & Volume</h4>
            <div class="sound-controls-row">
                 <select id="bell-sound-select">
                    <option value="silent">Silent</option>
                    <option value="audio/temple-bell.mp3">Temple Bell</option>
                    <option value="audio/wind-chime.mp3">Wind Chime</option>
                </select>
                <button id="preview-sound-btn" class="icon-btn"><i class="fas fa-volume-up"></i></button>
            </div>
             <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
        </div>
    </div>

<!-- Journaling Widget START -->
<div id="journaling-widget" class="widget" role="complementary" aria-labelledby="journaling-widget-title">
    <h3 id="journaling-widget-title">My Journal</h3>
    <div id="journal-entry-area">
        <div class="journal-input-wrapper">
             <textarea id="journal-text-input" placeholder="Write your thoughts..." aria-label="Journal Entry"></textarea>
             <div class="journal-footer">
                <div id="journal-mood-selector" role="group" aria-label="Mood">
                    <button class="mood-btn" data-mood="üòä">üòä</button>
                    <button class="mood-btn" data-mood="üôÇ">üôÇ</button>
                    <button class="mood-btn" data-mood="üòê">üòê</button>
                    <button class="mood-btn" data-mood="üòï">üòï</button>
                    <button class="mood-btn" data-mood="üòü">üòü</button>
                    <button class="mood-btn" data-mood="üò¢">üò¢</button>
                </div>
                <button id="journal-save-btn" class="btn btn-primary btn-sm">Save</button>
             </div>
        </div>
    </div>
    <div id="journal-history-area">
        <div class="journal-history-header">
             <h4>Past Entries</h4>
             <div id="journal-navigation-controls">
                <button id="journal-prev-entry-btn" class="icon-btn"><i class="fas fa-chevron-left"></i></button>
                <input type="date" id="journal-date-picker">
                <button id="journal-next-entry-btn" class="icon-btn"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
        <div id="journal-current-entry-display" class="journal-card">
            <div class="journal-entry-meta">
                <span id="journal-entry-date-display">--</span>
                <span id="journal-entry-mood-display"></span>
            </div>
            <div id="journal-entry-text-display" class="journal-text-content">
                <p class="placeholder-text">Select a date to view entry.</p>
            </div>
        </div>
    </div>
</div>
<!-- Journaling Widget END -->
            </aside>
        </main>
    </div>

    <!-- Redesigned Gallery Controls -->
    <div id="gallery-controls-bar">
        <div class="controls-left">
            <div id="image-info-compact">
                 <span class="info-title">Loading...</span>
                 <span class="info-location"></span>
            </div>
        </div>
        <div class="controls-center">
            <button id="prev-image" class="control-btn" aria-label="Previous"><i class="fas fa-step-backward"></i></button>
            <button id="toggle-rotation" class="control-btn play-pause-btn" aria-label="Pause"><i class="fas fa-pause"></i></button>
            <button id="next-image" class="control-btn" aria-label="Next"><i class="fas fa-step-forward"></i></button>
        </div>
        <div class="controls-right">
             <select id="category-filter" aria-label="Category">
                <option value="all">All</option>
            </select>
            <button id="info-toggle-btn" class="control-btn" aria-label="Info"><i class="fas fa-info-circle"></i></button>
        </div>
    </div>

    <!-- Hidden original controls div to maintain JS compatibility if needed, or I will update JS to target new IDs if they changed significantly.
         I kept IDs same where possible. 'gallery-controls' ID was used in JS. I will map old ID to new structure or update JS.
         The JS looks for 'gallery-controls'. I will give the new bar that ID?
         No, the previous 'gallery-controls' was a specific div. I'll use 'gallery-controls' for the new bar wrapper.
    -->

    <!-- Main Audio Player Section -->
    <div id="main-audio-player-container" class="glass-panel player-floating">
        <div class="player-content">
            <div class="track-info">
                <div class="track-text">
                    <span id="current-track-name">Track Name</span>
                    <span id="current-track-artist">Artist</span>
                </div>
                <div class="track-time">
                    <span id="current-track-time">0:00</span>
                </div>
            </div>
            <div class="player-controls">
                <button id="audio-prev-btn" class="player-btn"><i class="fas fa-backward"></i></button>
                <button id="audio-play-pause-btn" class="player-btn play-btn"><i class="fas fa-play"></i></button>
                <button id="audio-next-btn" class="player-btn"><i class="fas fa-forward"></i></button>
            </div>
            <div class="volume-container">
                 <button id="audio-mute-btn" class="player-btn"><i class="fas fa-volume-up"></i></button>
                 <input type="range" id="audio-volume-slider" min="0" max="1" step="0.01" value="0.5">
            </div>
        </div>
        <progress id="track-progress-bar" value="0" max="100"></progress>
    </div>
    <!-- End Main Audio Player Section -->

    <!-- Modals -->
    <div id="quick-link-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="quick-link-modal-title">Add New Link</h4>
                <button id="close-modal-btn" class="close-btn">&times;</button>
            </div>
            <form id="quick-link-form">
                <div class="form-group">
                    <label for="link-name">Name</label>
                    <input type="text" id="link-name" name="link-name" required maxlength="25">
                </div>
                <div class="form-group">
                    <label for="link-url">URL</label>
                    <input type="url" id="link-url" name="link-url" required>
                </div>
                <!-- ... other inputs ... -->
                <div class="form-actions">
                    <button type="button" id="cancel-link-btn" class="btn btn-text">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Lightbox Structure -->
    <div id="lightbox-overlay" class="lightbox-hidden">
        <div id="lightbox-container">
            <img id="lightbox-image" src="" alt="Lightbox Image">
            <button id="lightbox-close-btn" class="lightbox-close" aria-label="Close">&times;</button>
            <div id="lightbox-info"></div>
            <button id="lightbox-prev-btn" class="lightbox-nav-btn prev" aria-label="Previous">&lt;</button>
            <button id="lightbox-next-btn" class="lightbox-nav-btn next" aria-label="Next">&gt;</button>
        </div>
    </div>

    <!-- Important: I need to handle the ID mismatch for gallery controls since I changed the HTML structure significantly.
         Original ID: gallery-controls. New structure uses gallery-controls-bar but I should probably rename it to gallery-controls to keep JS working.
    -->
    <script>
        // Simple script to handle legacy ID mapping if needed, or I will update the ID in the HTML above.
        // I'll update the ID in HTML to be 'gallery-controls' to match JS expectation.
        document.getElementById('gallery-controls-bar').id = 'gallery-controls';
    </script>

    <script src="js/seasonal-engine.js" defer></script>
    <script src="js/gallery.js" defer></script>
    <script src="js/main-audio-player.js" defer></script>
    <script src="js/visual-system.js" defer></script>
    <script src="js/daily_inspiration.js" defer></script>
    <script src="js/time-widget.js" defer></script>
    <script src="js/weather-widget.js" defer></script>
    <script src="js/quick-links.js" defer></script>
    <script src="js/meditation-timer.js" defer></script>
    <script src="js/widget-customizer.js" defer></script>
    <script src="js/layout-switcher.js" defer></script>
    <script src="js/theme-switcher.js" defer></script>
    <script src="js/journaling-widget.js" defer></script>
</body>
</html>
